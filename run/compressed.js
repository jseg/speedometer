!function(){function e(e,t,n){function a(){var a,i=t.getTripTime();a=0==i?0:e.get()/(i/1e3),a=18*a/5,a=n.fix(a),a=Math.min(999.99,a),d.nodeValue=String(Math.floor(a)),r.nodeValue=Math.floor(a%1*10)}var i="SpeedPanel",d=b("0"),o=l(i+"-integerPart");o.appendChild(d);var r=b("0"),c=l(i+"-fractionalPart");c.appendChild(b(".")),c.appendChild(r);var h=b(n.speedLabel),p=l(i+"-unit");p.appendChild(h);var u=l("BottomPanel-label");u.appendChild(b("AVERAGE SPEED"));var s=u.classList,f=l("BottomPanel");f.appendChild(u),f.appendChild(o),f.appendChild(c),f.appendChild(p);var m,v=f.classList;return{element:f,reset:a,update:a,highlight:function(){clearTimeout(m),v.add("highlight"),s.add("highlight"),m=setTimeout(function(){v.remove("highlight"),s.remove("highlight")},200)},setUnit:function(e){n=e,h.nodeValue=n.speedLabel,a()}}}function t(e){var t="AverageSpeedTab",n=l(t+"-content Tab-content");n.appendChild(b("AVERAGE")),n.appendChild(document.createElement("br")),n.appendChild(b("SPEED"));var a=l(t+" Tab Button");a.appendChild(l(t+"-aligner Tab-aligner")),a.appendChild(n);var i=a.classList,d=p(a,function(){e(),i.add("selected")});return d.enable(),{element:a,deselect:function(){i.remove("selected")}}}function n(){var e="ClockPanel",t=b("00"),n=b("00"),a=b("00"),i=l(e+"-second");i.appendChild(b(":")),i.appendChild(a);var d=l(e+"-content BottomPanel-content");d.appendChild(t),d.appendChild(b(":")),d.appendChild(n),d.appendChild(i);var o=l("BottomPanel-label");o.appendChild(b("CLOCK"));var r=o.classList,c=l(e+" BottomPanel");c.appendChild(o),c.appendChild(d);var h,p=c.classList;return{element:c,highlight:function(){clearTimeout(h),p.add("highlight"),r.add("highlight"),h=setTimeout(function(){p.remove("highlight"),r.remove("highlight")},200)},update:function(){var e=new Date;t.nodeValue=I(e.getHours()),n.nodeValue=I(e.getMinutes()),a.nodeValue=I(e.getSeconds())}}}function a(e){var t=l("Tab ClockTab Button");t.appendChild(b("CLOCK"));var n=t.classList,a=p(t,function(){e(),n.add("selected")});return a.enable(),{element:t,deselect:function(){n.remove("selected")}}}function i(e,t){function n(e){return e*Math.PI/180}var a=e.coords,i=t.coords,l=n(a.latitude),d=n(a.longitude),o=n(i.latitude),r=n(i.longitude),c=6371e3,h=o-l,p=r-d,u=Math.sin(h/2),s=Math.sin(p/2),f=u*u+Math.cos(l)*Math.cos(o)*s*s,m=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),v=c*m;return v}function l(e){var t=document.createElement("div");return t.className=e,t}function d(){return{key:"imperial",distanceLabel:"M",speedLabel:"M/H",fix:function(e){return e}}}function o(){function t(e){E.setUnit(e),A.setUnit(e),w.setUnit(e),D.setUnit(e),N.unit=e.key,N.save()}function a(){o(function(){setTimeout(function(){A.update(),B.update(),V.update(),D.update(),a()},50)})}function i(e){p&&m.add(e);var t=e.coords,n=t.speed;E.setSpeed(n),p&&w.setSpeed(n);var a=t.accuracy;k.setStatus(6>a?"SIGNAL GOOD":12>a?"SIGNAL OK":"SIGNAL WEAK")}var o=window.requestAnimationFrame,c=window.cancelAnimationFrame;o||(o=window.mozRequestAnimationFrame,c=window.mozCancelAnimationFrame);var p=!1,m=L(),b=d(),S=h(),E=v(S),I=T(function(){O.removeChild(O.firstChild),O.appendChild(B.element),B.highlight()},function(){O.removeChild(O.firstChild),O.appendChild(A.element),A.highlight()},function(){O.removeChild(O.firstChild),O.appendChild(V.element),V.highlight()},function(){O.removeChild(O.firstChild),O.appendChild(w.element),w.highlight()},function(){O.removeChild(O.firstChild),O.appendChild(D.element),D.highlight()},function(){O.removeChild(O.firstChild),O.appendChild(R.element),R.highlight()}),B=P(),A=M(m,S),V=n(),w=r(S),D=e(m,B,S),N=s(),R=f(N,function(){t(b)},function(){t(S)});t("imperial"==N.unit?b:S);var F="MainPanel",O=l(F+"-panel");O.appendChild(A.element);var y=u(function(){m.reset(),B.reset(),A.reset(),w.reset(),D.reset()}),U=C(function(){p=!0,B.start(),m.start()},function(){p=!1,B.stop()}),k=g(),G=l(F+"-content");G.appendChild(E.element),G.appendChild(O),G.appendChild(I.element),G.appendChild(y),G.appendChild(U.element),G.appendChild(k.element);var x=l(F);return x.appendChild(G),navigator.geolocation.watchPosition(i,function(e){var t=e.code;k.setStatus(t==e.PERMISSION_DENIED?"PERMISSION DENIED":t==e.POSITION_UNAVAILABLE?"POSITION UNAVAILABLE":"TIMEOUT")},{enableHighAccuracy:!0}),a(),navigator.requestWakeLock&&navigator.requestWakeLock("screen"),{element:x,resize:function(e,t){var n=e/320;452*n>t&&(n=t/452),x.style.transform="scale("+n+")"}}}function r(e){function t(e){v=e,n()}function n(){speed=18*v/5,speed=e.fix(speed),speed=Math.min(999.99,speed),i.nodeValue=String(Math.floor(speed)),o.nodeValue=Math.floor(speed%1*10)}var a="SpeedPanel",i=b("0"),d=l(a+"-integerPart");d.appendChild(i);var o=b("0"),r=l(a+"-fractionalPart");r.appendChild(b(".")),r.appendChild(o);var c=b(e.speedLabel),h=l(a+"-unit");h.appendChild(c);var p=l("BottomPanel-label");p.appendChild(b("MAX SPEED"));var u=p.classList,s=l("BottomPanel");s.appendChild(p),s.appendChild(d),s.appendChild(r),s.appendChild(h);var f,m=s.classList,v=0;return{element:s,highlight:function(){clearTimeout(f),m.add("highlight"),u.add("highlight"),f=setTimeout(function(){m.remove("highlight"),u.remove("highlight")},200)},reset:function(){t(0)},setSpeed:function(e){isFinite(e)||(e=0),e>v&&t(e)},setUnit:function(t){e=t,c.nodeValue=e.speedLabel,n()}}}function c(e){var t="MaxSpeedTab",n=l(t+"-content Tab-content");n.appendChild(b("MAX")),n.appendChild(document.createElement("br")),n.appendChild(b("SPEED"));var a=l(t+" Tab Button");a.appendChild(l(t+"-aligner Tab-aligner")),a.appendChild(n);var i=a.classList,d=p(a,function(){e(),i.add("selected")});return d.enable(),{element:a,deselect:function(){i.remove("selected")}}}function h(){return{key:"metric",distanceLabel:"KM",speedLabel:"KM/H",fix:function(e){return 1.609344*e}}}function p(e,t){function n(){d.add("active"),clearTimeout(l),l=setTimeout(function(){t(),l=setTimeout(function(){d.remove("active")},150)},100)}function a(e){0===e.button&&(e.preventDefault(),o?o=!1:n())}function i(e){e.preventDefault(),o=!0,n()}var l,d=e.classList,o=!1;return{disable:function(){e.removeEventListener("touchstart",i),e.removeEventListener("mousedown",a)},enable:function(){e.addEventListener("mousedown",a),e.addEventListener("touchstart",i)}}}function u(e){var t=l("ResetButton Button");t.appendChild(b("RESET"));var n=p(t,e);return n.enable(),t}function s(){var e;try{e=localStorage.unit}catch(t){}var n={unit:e,save:function(){try{localStorage.unit=n.unit}catch(e){}}};return n}function f(e,t,n){var a="SettingsPanel",i=l(a+"-imperialButton "+a+"-button Button");i.appendChild(b("IMPERIAL"));var d=p(i,function(){o.classList.remove("selected"),i.classList.add("selected"),t()});d.enable();var o=l(a+"-metricButton "+a+"-button Button");o.appendChild(b("METRIC"));var r=p(o,function(){i.classList.remove("selected"),o.classList.add("selected"),n()});r.enable(),"imperial"==e.unit?i.classList.add("selected"):o.classList.add("selected");var c=l(a+"-fieldLabel");c.appendChild(b("UNITS:"));var h=l("BottomPanel-label");h.appendChild(b("SETTINGS"));var u=h.classList,s=l("BottomPanel");s.appendChild(h),s.appendChild(c),s.appendChild(i),s.appendChild(o);var f,m=s.classList;return{element:s,highlight:function(){clearTimeout(f),m.add("highlight"),u.add("highlight"),f=setTimeout(function(){m.remove("highlight"),u.remove("highlight")},200)}}}function m(e){var t=l("Tab SettingsTab Button");t.appendChild(b("SETTINGS"));var n=t.classList,a=p(t,function(){e(),n.add("selected")});return a.enable(),{element:t,deselect:function(){n.remove("selected")}}}function v(e){function t(){var t=e.fix(18*v/5);t=Math.min(999.99,t),a.nodeValue=Math.floor(t),d.nodeValue=Math.floor(t%1*10);var n="";n=T?g?"":"↑":g?"↓":"",p.nodeValue=n}var n="SpeedLabel",a=b("0"),i=l(n+"-integerPart");i.appendChild(a);var d=b("0"),o=l(n+"-fractionalPart");o.appendChild(b(".")),o.appendChild(d);var r=b(e.speedLabel),c=l(n+"-unit");c.appendChild(r);var h=l(n+"-label");h.appendChild(b("SPEED"));var p=b("↕"),u=l(n+"-arrow");u.appendChild(p);var s=l(n);s.appendChild(h),s.appendChild(u),s.appendChild(i),s.appendChild(o),s.appendChild(c);var f,m,v=0,C=0,g=0,T=0;return{element:s,setSpeed:function(e){isFinite(e)||(e=0),e>C?(T=!0,clearTimeout(f),m=setTimeout(function(){T=!1},3e3)):C>e&&(g=!0,clearTimeout(m),f=setTimeout(function(){g=!1},3e3)),C=v,v=e,t()},setUnit:function(n){e=n,r.nodeValue=e.speedLabel,t()}}}function C(e,t){var n=!1,a=b("START"),i=l("StartStopButton Button");i.appendChild(a);var d=p(i,function(){n?(n=!1,a.nodeValue="START",t()):(n=!0,a.nodeValue="STOP",e())});return d.enable(),{element:i}}function g(){var e=b("INITIALIZING"),t=l("StatusPanel");t.appendChild(b("GPS: ")),t.appendChild(e);var n,a=t.classList;return{element:t,setStatus:function(t){t!=e.nodeValue&&(e.nodeValue=t,clearTimeout(n),a.add("highlight"),n=setTimeout(function(){a.remove("highlight")},200))}}}function T(e,n,i,d,o,r){var h=S(function(){p.deselect(),u.deselect(),s.deselect(),f.deselect(),v.deselect(),n()}),p=E(function(){h.deselect(),u.deselect(),s.deselect(),f.deselect(),v.deselect(),e()}),u=a(function(){h.deselect(),p.deselect(),s.deselect(),f.deselect(),v.deselect(),i()}),s=c(function(){h.deselect(),p.deselect(),u.deselect(),f.deselect(),v.deselect(),d()}),f=t(function(){h.deselect(),p.deselect(),u.deselect(),s.deselect(),v.deselect(),o()}),v=m(function(){h.deselect(),p.deselect(),u.deselect(),s.deselect(),f.deselect(),r()}),C="Tabs",g=l(C+"-row1");g.appendChild(h.element),g.appendChild(p.element),g.appendChild(u.element);var T=l(C+"-row2");T.appendChild(s.element),T.appendChild(f.element),T.appendChild(v.element);var b=l(C);return b.appendChild(g),b.appendChild(T),{element:b}}function b(e){return document.createTextNode(e)}function L(){var e=null,t=0;return{add:function(n){e&&(t+=i(e,n)),e=n},get:function(){return t},reset:function(){e=null,t=0},start:function(){e=null}}}function M(e,t){function n(){var n=e.get();n=t.fix(n),n=Math.min(999999,Math.floor(n));var a=String(n%1e3);1==a.length?a="00"+a:2==a.length&&(a="0"+a),o.nodeValue=a,i.nodeValue=Math.floor(n/1e3)}var a="TripDistancePanel",i=b("0"),d=l(a+"-integerPart");d.appendChild(i);var o=b("000"),r=l(a+"-fractionalPart");r.appendChild(b(".")),r.appendChild(o);var c=b(t.distanceLabel),h=l(a+"-unit");h.appendChild(c);var p=l("BottomPanel-label");p.appendChild(b("TRIP DISTANCE"));var u=p.classList,s=l("BottomPanel");s.appendChild(p),s.appendChild(d),s.appendChild(r),s.appendChild(h);var f,m=s.classList;return{element:s,reset:n,update:n,highlight:function(){clearTimeout(f),m.add("highlight"),u.add("highlight"),f=setTimeout(function(){m.remove("highlight"),u.remove("highlight")},200)},setUnit:function(e){t=e,c.nodeValue=t.distanceLabel,n()}}}function S(e){var t="TripDistanceTab",n=l(t+"-content Tab-content");n.appendChild(b("TRIP")),n.appendChild(document.createElement("br")),n.appendChild(b("DISTANCE"));var a=l(t+" Tab Button");a.appendChild(l(t+"-aligner Tab-aligner")),a.appendChild(n);var i=a.classList;i.add("selected");var d=p(a,function(){e(),i.add("selected")});return d.enable(),{element:a,deselect:function(){i.remove("selected")}}}function P(){var e="ClockPanel",t=b("00"),n=b("00"),a=b("00"),i=l(e+"-second");i.appendChild(b(":")),i.appendChild(a);var d=l("BottomPanel-label");d.appendChild(b("TRIP TIME"));var o=d.classList,r=l(e+"-content");r.appendChild(t),r.appendChild(b(":")),r.appendChild(n),r.appendChild(i);var c=l(e+" BottomPanel");c.appendChild(d),c.appendChild(r);var h,p=c.classList,u=0,s=null,f=359999e3;return{element:c,getTripTime:function(){return u},highlight:function(){clearTimeout(h),p.add("highlight"),o.add("highlight"),h=setTimeout(function(){p.remove("highlight"),o.remove("highlight")},200)},reset:function(){u=0,null!==s&&(s=Date.now())},start:function(){s=Date.now()},stop:function(){u+=Date.now()-s,u=Math.min(u,f),s=null},update:function(){if(null!==s){var e=Date.now();u+=e-s,s=e}u=Math.min(u,f);var i=u/1e3;a.nodeValue=I(Math.floor(i%60));var l=i/60;n.nodeValue=I(Math.floor(l%60));var d=l/60;t.nodeValue=I(Math.floor(d))}}}function E(e){var t="TripTimeTab",n=l(t+"-content Tab-content");n.appendChild(b("TRIP")),n.appendChild(document.createElement("br")),n.appendChild(b("TIME"));var a=l(t+" Tab Button");a.appendChild(l(t+"-aligner Tab-aligner")),a.appendChild(n);var i=a.classList,d=p(a,function(){e(),i.add("selected")});return d.enable(),{element:a,deselect:function(){i.remove("selected")}}}function I(e){return e=String(e),1==e.length&&(e="0"+e),e}!function(){function e(){t.resize(innerWidth,innerHeight)}!function(){var e=document.createElement("style");e.innerHTML='@font-face {font-family: FreeMono;src: url(fonts/FreeMono.ttf);src: local("FreeMono"), url(fonts/FreeMono.ttf);font-weight: normal;}@font-face {font-family: FreeMono;src: url(fonts/FreeMonoBold.ttf);src: local("FreeMono Bold"), url(fonts/FreeMonoBold.ttf);font-weight: bold;}',document.head.appendChild(e)}();var t=o();document.body.appendChild(t.element),addEventListener("resize",e),e()}()}();