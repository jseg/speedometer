!function(){function e(e){function n(){var n,t;if(null===m)t="···",n="·";else{var a=Math.floor(e.fix(m));a=Math.min(999999,Math.max(-99999,a));var t=String(Math.abs(a)%1e3);1==t.length?t="00"+t:2==t.length&&(t="0"+t),n=Math.floor(Math.abs(a)/1e3),0>a&&(n="-"+n)}i.nodeValue=n,l.nodeValue=t}var t="AltitudePanel",i=V("0"),a=u(t+"-integerPart");a.appendChild(i);var l=V("000"),o=u(t+"-fractionalPart");o.appendChild(V(".")),o.appendChild(l);var d=V(e.distanceLabel),r=u(t+"-unit");r.appendChild(d);var h=u("BottomPanel-label");h.appendChild(V("ALTITUDE"));var c=h.classList,p=u("BottomPanel");p.appendChild(h),p.appendChild(a),p.appendChild(o),p.appendChild(r);var s,f=p.classList,m=null,v=[],C="highlight";return{element:p,highlight:function(){f.add(C),c.add(C),clearTimeout(s),s=setTimeout(function(){f.remove(C),c.remove(C)},200)},setAltitude:function(e){if("number"==typeof e&&isFinite(e)){v.push(e),v.length>3&&v.shift();var t=0;v.forEach(function(e){t+=e}),t/=v.length,m=t}else m=null,v.splice(0);n()},setUnit:function(t){e=t,d.nodeValue=e.distanceLabel,n()}}}function n(e){return g("ALTITUDE","AltitudeTab",e)}function t(e){var n={latitude:0,longitude:0};return e.forEach(function(e){n.latitude+=e.coords.latitude,n.longitude+=e.coords.longitude}),n.latitude/=e.length,n.longitude/=e.length,{coords:n}}function i(e,n,t){function i(){var i,a=n.getTripTime();i=0==a?0:e.get()/(a/1e3),i=t.fix(18*i/5),i=Math.min(999.99,i),l.nodeValue=Math.floor(i),d.nodeValue=Math.floor(i%1*10)}var a="SpeedPanel",l=V("0"),o=u(a+"-integerPart");o.appendChild(l);var d=V("0"),r=u(a+"-fractionalPart");r.appendChild(V(".")),r.appendChild(d);var h=V(t.speedLabel),c=u(a+"-unit");c.appendChild(h);var p=u("BottomPanel-label");p.appendChild(V("AVERAGE SPEED"));var s=p.classList,f=u("BottomPanel");f.appendChild(p),f.appendChild(o),f.appendChild(r),f.appendChild(c);var m,v=f.classList,C="highlight";return{element:f,reset:i,update:i,highlight:function(){v.add(C),s.add(C),clearTimeout(m),m=setTimeout(function(){v.remove(C),s.remove(C)},200)},setUnit:function(e){t=e,h.nodeValue=t.speedLabel,i()}}}function a(e){return F("AVERAGE","SPEED","AverageSpeedTab",e)}function l(){var e="ClockPanel",n=V("00"),t=V("00"),i=V("00"),a=u(e+"-second");a.appendChild(V(":")),a.appendChild(i);var l=u(e+"-content BottomPanel-content");l.appendChild(n),l.appendChild(V(":")),l.appendChild(t),l.appendChild(a);var o=u("BottomPanel-label");o.appendChild(V("CLOCK"));var d=o.classList,r=u(e+" BottomPanel");r.appendChild(o),r.appendChild(l);var h,c=r.classList,p="highlight";return{element:r,highlight:function(){c.add(p),d.add(p),clearTimeout(h),h=setTimeout(function(){c.remove(p),d.remove(p)},200)},update:function(){var e=new Date;n.nodeValue=R(e.getHours()),t.nodeValue=R(e.getMinutes()),i.nodeValue=R(e.getSeconds())}}}function o(e){return g("CLOCK","ClockTab",e)}function d(){function e(){var e;if(e=null===l?0:l*Math.PI/180,a.clearRect(0,0,t,t),a.save(),a.translate(i,i),a.rotate(-e),null!==l){var n=.01*t;a.save(),a.lineWidth=n,a.beginPath(),a.moveTo(0,0),a.rotate(-Math.PI/2),a.arc(0,0,i-n,0,e),a.closePath(),a.fillStyle="#444",a.fill(),a.lineJoin="round",a.strokeStyle="#999",a.stroke(),a.restore()}a.save();for(var o=0;60>o;o++){if(a.beginPath(),o%5||null===l){var n=.01*t;a.lineWidth=n,a.moveTo(0,.98*i),a.lineTo(0,.95*i),a.strokeStyle="#999"}else a.lineWidth=.03*t,a.moveTo(0,.98*i),a.lineTo(0,.92*i),a.strokeStyle="#fff";a.stroke(),a.rotate(Math.PI/30)}if(a.restore(),null!==l){var d=.92*-i;a.save(),a.font="bold "+.25*t+"px FreeMono, monospace",a.textAlign="center",a.textBaseline="top",a.fillStyle="#f00",a.fillText("N",0,d),a.fillStyle="#999",a.rotate(Math.PI/2),a.fillText("E",0,d),a.rotate(Math.PI/2),a.fillText("S",0,d),a.rotate(Math.PI/2),a.fillText("W",0,d),a.restore()}a.restore()}var n=document.createElement("canvas");n.className="CompassPanel";var t,i,a=n.getContext("2d"),l=null;return{element:n,resize:function(a){t=116*a*devicePixelRatio,i=t/2,n.width=n.height=t,e()},setHeading:function(n){l=n,e()}}}function r(e,n){function t(e){return e*Math.PI/180}var i=e.coords,a=n.coords,l=t(i.latitude),o=t(i.longitude),d=t(a.latitude),r=t(a.longitude),u=6371e3,h=d-l,c=r-o,p=Math.sin(h/2),s=Math.sin(c/2),f=p*p+Math.cos(l)*Math.cos(d)*s*s,m=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),v=u*m;return v}function u(e){var n=document.createElement("div");return n.className=e,n}function h(){function e(){var e;e=null===f?"·":Math.round(f),i.nodeValue=e}var n="HeadingPanel",t=u(n+"-unit");t.appendChild(V("°"));var i=V("·"),a=u(n+"-value");a.appendChild(i),a.appendChild(t);var l=u("BottomPanel-label");l.appendChild(V("HEADING"));var o=l.classList,r=d(),h=u("BottomPanel");h.appendChild(l),h.appendChild(a),h.appendChild(r.element);var c,p=h.classList,s="highlight",f=null,m=null,v=[];return{element:h,resize:r.resize,highlight:function(){p.add(s),o.add(s),clearTimeout(c),c=setTimeout(function(){p.remove(s),o.remove(s)},200)},setHeading:function(n){if("number"==typeof n&&isFinite(n)){null!=m&&(n-m>180?n-=360:-180>n-m&&(n+=360)),m=n,v.push(n),v.length>3&&v.shift();var t=0;v.forEach(function(e){t+=e}),t/=v.length,f=(t%360+360)%360}else f=null,m=null,v.splice(0);r.setHeading(f),e()}}}function c(e){return g("HEADING","HeadingTab",e)}function p(){return{key:"imperial",distanceLabel:"MI",speedLabel:"MI/H",fix:function(e){return e/1.609344}}}function s(){function n(e){k.removeChild(k.firstChild),k.appendChild(e.element),e.highlight()}function t(e){T.setSpeed(e),s&&F.setSpeed(e)}function a(e){T.setUnit(e),V.setUnit(e),F.setUnit(e),U.setUnit(e),x.setUnit(e),G.unit=e.key,G.save()}function o(){var e=Date.now();r(function(){E.update(),R.update(),U.update(),setTimeout(o,Math.max(0,e+1e3-Date.now()))})}function d(e){s&&(m.add(e),V.update());var n=e.coords;t(n.speed);var i=n.accuracy;W.setStatus(8>i?"SIGNAL GOOD":16>i?"SIGNAL OK":"SIGNAL WEAK"),_(n.altitude),J(n.heading),W.hideError()}var r=window.requestAnimationFrame,c=window.cancelAnimationFrame;r||(r=window.mozRequestAnimationFrame,c=window.mozCancelAnimationFrame);var s=!1,m=D(),C=p(),g=v(),T=S(g),P=B(function(){n(E)},function(){n(V)},function(){n(R)},function(){n(F)},function(){n(U)},function(){n(H)},function(){n(x)},function(){n(N)}),E=y(),V=w(m,g),x=e(g),N=h(),R=l(),F=f(g),U=i(m,E,g),G=L(),H=b(G,function(){a(C)},function(){a(g)});a("imperial"==G.unit?C:g);var O="MainPanel",k=u(O+"-panel");k.appendChild(V.element);var z=M(function(){m.reset(),V.update(),E.reset(),F.reset(),U.reset()}),K=I(function(){s=!0,E.start(),m.start()},function(){s=!1,E.stop()}),W=A(),q=u(O+"-content");q.appendChild(T.element),q.appendChild(k),q.appendChild(W.element),q.appendChild(P.element),q.appendChild(z),q.appendChild(K.element);var X=u(O);X.appendChild(q);var _=x.setAltitude,J=N.setHeading;return navigator.geolocation.watchPosition(d,function(e){var n=e.code;W.setStatus(n==e.PERMISSION_DENIED?"PERMISSION DENIED":n==e.POSITION_UNAVAILABLE?"POSITION UNAVAILABLE":"TIMEOUT, RETRYING"),t(null),_(null),J(null),W.showError()},{enableHighAccuracy:!0,maximumAge:3e4,timeout:3e4}),o(),{element:X,resize:function(e,n){var t=320,i=480;if(e>n){var a=t;t=i,i=a}q.style.width=t+"px",q.style.height=i+"px",q.style.top=-i/2+"px",q.style.left=-t/2+"px";var l=e/t;l*i>n&&(l=n/i),X.style.transform="scale("+l+")",N.resize(l)}}}function f(e){function n(e){v=e,t()}function t(){var n=e.fix(18*v/5);n=Math.min(999.99,n),a.nodeValue=Math.floor(n),o.nodeValue=Math.floor(n%1*10)}var i="SpeedPanel",a=V("0"),l=u(i+"-integerPart");l.appendChild(a);var o=V("0"),d=u(i+"-fractionalPart");d.appendChild(V(".")),d.appendChild(o);var r=V(e.speedLabel),h=u(i+"-unit");h.appendChild(r);var c=u("BottomPanel-label");c.appendChild(V("MAX SPEED"));var p=c.classList,s=u("BottomPanel");s.appendChild(c),s.appendChild(l),s.appendChild(d),s.appendChild(h);var f,m=s.classList,v=0,C="highlight";return{element:s,highlight:function(){m.add(C),p.add(C),clearTimeout(f),f=setTimeout(function(){m.remove(C),p.remove(C)},200)},reset:function(){n(0)},setSpeed:function(e){isFinite(e)||(e=0),e>v&&n(e)},setUnit:function(n){e=n,r.nodeValue=e.speedLabel,t()}}}function m(e){return F("MAX","SPEED","MaxSpeedTab",e)}function v(){return{key:"metric",distanceLabel:"KM",speedLabel:"KM/H",fix:function(e){return e}}}function C(e,n){function t(){a.add("active"),clearTimeout(i),i=setTimeout(function(){n(),i=setTimeout(function(){a.remove("active")},150)},100)}var i,a=e.classList,l=!1;e.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),l?l=!1:t())}),e.addEventListener("touchstart",function(e){e.preventDefault(),l=!0,t()})}function g(e,n,t){var i=u("Tab-highlight");i.appendChild(V(e));var a=i.classList,l=u(n+" OneLineTab Tab Button");l.appendChild(i),C(l,t);var o,d=l.classList,r=!1,h="selected",c="highlight";return{element:l,deselect:function(){r=!1,d.remove(h),a.remove(h)},highlight:function(){a.add(c),clearTimeout(o),o=setTimeout(function(){a.remove(c)},200)},select:function(){r=!0,d.add(h),a.add(h)}}}function T(e){return g("PAGE 1","Page1Tab",e)}function P(e){return g("PAGE 2","Page2Tab",e)}function M(e){var n=u("ResetButton Button");return n.appendChild(V("RESET")),C(n,e),n}function L(){var e;try{e=localStorage.unit}catch(n){}var t={unit:e,save:function(){try{localStorage.unit=t.unit}catch(e){}}};return t}function b(e,n,t){var i="SettingsPanel",a="selected",l=u(i+"-imperialButton "+i+"-button Button");l.appendChild(V("IMPERIAL")),C(l,function(){o.classList.remove(a),l.classList.add(a),n()});var o=u(i+"-metricButton "+i+"-button Button");o.appendChild(V("METRIC")),C(o,function(){l.classList.remove(a),o.classList.add(a),t()}),"imperial"==e.unit?l.classList.add(a):o.classList.add(a);var d=u(i+"-fieldLabel");d.appendChild(V("UNITS:"));var r=u("BottomPanel-label");r.appendChild(V("SETTINGS"));var h=r.classList,c=u("BottomPanel");c.appendChild(r),c.appendChild(d),c.appendChild(l),c.appendChild(o);var p,s=c.classList,f="highlight";return{element:c,highlight:function(){s.add(f),h.add(f),clearTimeout(p),p=setTimeout(function(){s.remove(f),h.remove(f)},200)}}}function E(e){return g("SETTINGS","SettingsTab",e)}function S(e){function n(){var n,t,a;if(null===v)a="",n="·",t="·";else{var o=e.fix(18*v/5);o=Math.min(999.99,o),n=Math.floor(o),t=Math.floor(o%1*10),a=T?g?"":"↑":g?"↓":""}i.nodeValue=n,l.nodeValue=t,c.nodeValue=a}var t="SpeedLabel",i=V("·"),a=u(t+"-integerPart");a.appendChild(i);var l=V("·"),o=u(t+"-fractionalPart");o.appendChild(V(".")),o.appendChild(l);var d=V(e.speedLabel),r=u(t+"-unit");r.appendChild(d);var h=u(t+"-label");h.appendChild(V("SPEED"));var c=V("↕"),p=u(t+"-arrow");p.appendChild(c);var s=u(t);s.appendChild(h),s.appendChild(p),s.appendChild(a),s.appendChild(o),s.appendChild(r);var f,m,v=null,C=null,g=!1,T=!1,P=.02,M=[];return{element:s,setSpeed:function(e){if("number"==typeof e&&isFinite(e)){M.push(e),M.length>3&&M.shift();var t=0;M.forEach(function(e){t+=e}),t/=M.length,null!==C&&(t>C+P?(T=!0,clearTimeout(m),m=setTimeout(function(){T=!1,n()},2500)):C-P>t&&(g=!0,clearTimeout(f),f=setTimeout(function(){g=!1,n()},2500))),C=v,v=t}else v=null,C=null,M.splice(0),g=T=!1,clearTimeout(f),clearTimeout(m);n()},setUnit:function(t){e=t,d.nodeValue=e.speedLabel,n()}}}function I(e,n){var t=!1,i=V("START"),a=u("StartStopButton Button");return a.appendChild(i),C(a,function(){t?(t=!1,i.nodeValue="START",n()):(t=!0,i.nodeValue="STOP",e())}),{element:a}}function A(){function e(){d.add(c),clearTimeout(o),o=setTimeout(function(){d.remove(c)},200)}var n="StatusPanel",t=V("ACQUIRING"),i=u(n+"-value");i.appendChild(t);var a=i.classList,l=u(n);l.appendChild(V("GPS")),l.appendChild(i);var o,d=l.classList,r=!1,h="error",c="highlight";return{element:l,hideError:function(){r&&(r=!1,a.remove(h),e())},setStatus:function(e){t.nodeValue=e},showError:function(){r||(r=!0,a.add(h),e())}}}function B(e,t,i,l,d,r,h,p){function s(e){V.forEach(function(n){e!=n&&n.deselect()}),e.select()}var f=1,v=x(function(){s(v),t()}),C=N(function(){s(C),e()}),g=m(function(){s(g),l()}),M=a(function(){s(M),d()}),L=n(function(){s(L),h()}),b=c(function(){s(b),p()}),S=o(function(){s(S),i()}),I=E(function(){s(I),r()}),A=T(function(){1!=f&&(f=1,B.deselect(),w.removeChild(L.element),w.removeChild(b.element),w.removeChild(I.element),w.removeChild(S.element),w.appendChild(v.element),w.appendChild(C.element),w.appendChild(g.element),w.appendChild(M.element)),v.highlight(),C.highlight(),g.highlight(),M.highlight()}),B=P(function(){2!=f&&(f=2,A.deselect(),w.removeChild(v.element),w.removeChild(C.element),w.removeChild(g.element),w.removeChild(M.element),w.appendChild(L.element),w.appendChild(b.element),w.appendChild(I.element),w.appendChild(S.element)),L.highlight(),b.highlight(),I.highlight(),S.highlight()}),V=[v,C,g,M,L,b,S,I],D="Tabs",w=u(D);return w.appendChild(v.element),w.appendChild(C.element),w.appendChild(g.element),w.appendChild(M.element),w.appendChild(A.element),w.appendChild(B.element),{element:w}}function V(e){return document.createTextNode(e)}function D(){var e=0,n=[];return{add:function(i){var a;if(n.length&&(a=t(n)),n.push(i),n.length>3&&n.shift(),a){var l=t(n);e+=r(a,l)}},get:function(){return e},reset:function(){n.splice(0),e=0},start:function(){n.splice(0)}}}function w(e,n){function t(){var t=n.fix(e.get());t=Math.min(999999,Math.floor(t));var i=String(t%1e3);1==i.length?i="00"+i:2==i.length&&(i="0"+i),o.nodeValue=i,a.nodeValue=Math.floor(t/1e3)}var i="TripDistancePanel",a=V("0"),l=u(i+"-integerPart");l.appendChild(a);var o=V("000"),d=u(i+"-fractionalPart");d.appendChild(V(".")),d.appendChild(o);var r=V(n.distanceLabel),h=u(i+"-unit");h.appendChild(r);var c=u("BottomPanel-label");c.appendChild(V("TRIP DISTANCE"));var p=c.classList,s=u("BottomPanel");s.appendChild(c),s.appendChild(l),s.appendChild(d),s.appendChild(h);var f,m=s.classList,v="highlight";return{element:s,update:t,highlight:function(){m.add(v),p.add(v),clearTimeout(f),f=setTimeout(function(){m.remove(v),p.remove(v)},200)},setUnit:function(e){n=e,r.nodeValue=n.distanceLabel,t()}}}function x(e){var n=F("TRIP","DISTANCE","TripDistanceTab",e);return n.select(),n}function y(){var e="ClockPanel",n=V("00"),t=V("00"),i=V("00"),a=u(e+"-second");a.appendChild(V(":")),a.appendChild(i);var l=u("BottomPanel-label");l.appendChild(V("TRIP TIME"));var o=l.classList,d=u(e+"-content");d.appendChild(n),d.appendChild(V(":")),d.appendChild(t),d.appendChild(a);var r=u(e+" BottomPanel");r.appendChild(l),r.appendChild(d);var h,c=r.classList,p=0,s=null,f=359999e3,m="highlight";return{element:r,getTripTime:function(){return p},highlight:function(){c.add(m),o.add(m),clearTimeout(h),h=setTimeout(function(){c.remove(m),o.remove(m)},200)},reset:function(){p=0,null!==s&&(s=Date.now())},start:function(){s=Date.now()},stop:function(){p+=Date.now()-s,p=Math.min(p,f),s=null},update:function(){if(null!==s){var e=Date.now();p+=e-s,s=e}p=Math.min(p,f);var a=p/1e3;i.nodeValue=R(Math.floor(a%60));var l=a/60;t.nodeValue=R(Math.floor(l%60));var o=l/60;n.nodeValue=R(Math.floor(o))}}}function N(e){return F("TRIP","TIME","TripTimeTab",e)}function R(e){return e=String(e),1==e.length&&(e="0"+e),e}function F(e,n,t,i){var a="TwoLineTab "+t,l=u(a+"-content Tab-content");l.appendChild(V(e)),l.appendChild(document.createElement("br")),l.appendChild(V(n));var o=u("Tab-highlight");o.appendChild(u(a+"-aligner Tab-aligner")),o.appendChild(l);var d=o.classList,r=u(a+" Tab Button");r.appendChild(o),C(r,i);var h,c=r.classList,p=!1,s="selected",f="highlight";return{element:r,deselect:function(){p=!1,c.remove(s),d.remove(s)},highlight:function(){d.add(f),clearTimeout(h),h=setTimeout(function(){d.remove(f)},200)},select:function(){p=!0,c.add(s),d.add(s)}}}!function(){function e(){n.resize(innerWidth,innerHeight)}!function(){var e=document.createElement("style");e.innerHTML='@font-face {font-family: FreeMono;src: url(fonts/FreeMono.ttf);src: local("FreeMono"), url(fonts/FreeMono.ttf);font-weight: normal;}@font-face {font-family: FreeMono;src: url(fonts/FreeMonoBold.ttf);src: local("FreeMono Bold"), url(fonts/FreeMonoBold.ttf);font-weight: bold;}',document.head.appendChild(e)}();var n=s();document.body.appendChild(n.element),addEventListener("resize",e),e()}()}();