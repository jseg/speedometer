!function(){function e(e){function t(){var t,n;if(null===m)n="···",t="·";else{var a=Math.floor(e.fix(m));a=Math.min(999999,Math.max(-99999,a));var n=String(Math.abs(a)%1e3);1==n.length?n="00"+n:2==n.length&&(n="0"+n),t=Math.floor(Math.abs(a)/1e3),0>a&&(t="-"+t)}i.nodeValue=t,l.nodeValue=n}var n="AltitudePanel",i=V("0"),a=u(n+"-integerPart");a.appendChild(i);var l=V("000"),o=u(n+"-fractionalPart");o.appendChild(V(".")),o.appendChild(l);var d=V(e.distanceLabel),r=u(n+"-unit");r.appendChild(d);var h=u("BottomPanel-label");h.appendChild(V("ALTITUDE"));var c=h.classList,p=u("BottomPanel");p.appendChild(h),p.appendChild(a),p.appendChild(o),p.appendChild(r);var s,f=p.classList,m=null,v=[],C="highlight";return{element:p,highlight:function(){f.add(C),c.add(C),clearTimeout(s),s=setTimeout(function(){f.remove(C),c.remove(C)},200)},setAltitude:function(e){if("number"==typeof e&&isFinite(e)){v.push(e),v.length>3&&v.shift();var n=0;v.forEach(function(e){n+=e}),n/=v.length,m=n}else m=null,v.splice(0);t()},setUnit:function(n){e=n,d.nodeValue=e.distanceLabel,t()}}}function t(e){return g("ALTITUDE","AltitudeTab",e)}function n(e){var t={latitude:0,longitude:0};return e.forEach(function(e){t.latitude+=e.coords.latitude,t.longitude+=e.coords.longitude}),t.latitude/=e.length,t.longitude/=e.length,{coords:t}}function i(e,t,n){function i(){var i,a=t.getTripTime();i=0==a?0:e.get()/(a/1e3),i=n.fix(18*i/5),i=Math.min(999.99,i),l.nodeValue=Math.floor(i),d.nodeValue=Math.floor(i%1*10)}var a="SpeedPanel",l=V("0"),o=u(a+"-integerPart");o.appendChild(l);var d=V("0"),r=u(a+"-fractionalPart");r.appendChild(V(".")),r.appendChild(d);var h=V(n.speedLabel),c=u(a+"-unit");c.appendChild(h);var p=u("BottomPanel-label");p.appendChild(V("AVERAGE SPEED"));var s=p.classList,f=u("BottomPanel");f.appendChild(p),f.appendChild(o),f.appendChild(r),f.appendChild(c);var m,v=f.classList,C="highlight";return{element:f,reset:i,update:i,highlight:function(){v.add(C),s.add(C),clearTimeout(m),m=setTimeout(function(){v.remove(C),s.remove(C)},200)},setUnit:function(e){n=e,h.nodeValue=n.speedLabel,i()}}}function a(e){return U("AVERAGE","SPEED","AverageSpeedTab",e)}function l(){var e="ClockPanel",t=V("00"),n=V("00"),i=V("00"),a=u(e+"-second");a.appendChild(V(":")),a.appendChild(i);var l=u(e+"-content BottomPanel-content");l.appendChild(t),l.appendChild(V(":")),l.appendChild(n),l.appendChild(a);var o=u("BottomPanel-label");o.appendChild(V("CLOCK"));var d=o.classList,r=u(e+" BottomPanel");r.appendChild(o),r.appendChild(l);var h,c=r.classList,p="highlight";return{element:r,highlight:function(){c.add(p),d.add(p),clearTimeout(h),h=setTimeout(function(){c.remove(p),d.remove(p)},200)},update:function(){var e=new Date;t.nodeValue=R(e.getHours()),n.nodeValue=R(e.getMinutes()),i.nodeValue=R(e.getSeconds())}}}function o(e){return g("CLOCK","ClockTab",e)}function d(){function e(){var e;if(e=null===l?0:l*Math.PI/180,a.clearRect(0,0,n,n),a.save(),a.translate(i,i),a.rotate(-e),null!==l){var t=.01*n;a.save(),a.lineWidth=t,a.beginPath(),a.moveTo(0,0),a.rotate(-Math.PI/2),a.arc(0,0,i-t,0,e),a.closePath(),a.fillStyle="#444",a.fill(),a.lineJoin="round",a.strokeStyle="#999",a.stroke(),a.restore()}a.save();for(var o=0;60>o;o++){if(a.beginPath(),o%5||null===l){var t=.01*n;a.lineWidth=t,a.moveTo(0,.98*i),a.lineTo(0,.95*i),a.strokeStyle="#999"}else a.lineWidth=.03*n,a.moveTo(0,.98*i),a.lineTo(0,.92*i),a.strokeStyle="#fff";a.stroke(),a.rotate(Math.PI/30)}if(a.restore(),null!==l){var d=.92*-i;a.save(),a.font="bold "+.25*n+"px FreeMono, monospace",a.textAlign="center",a.textBaseline="top",a.fillStyle="#f00",a.fillText("N",0,d),a.fillStyle="#999",a.rotate(Math.PI/2),a.fillText("E",0,d),a.rotate(Math.PI/2),a.fillText("S",0,d),a.rotate(Math.PI/2),a.fillText("W",0,d),a.restore()}a.restore()}var t=document.createElement("canvas");t.className="CompassPanel";var n,i,a=t.getContext("2d"),l=null;return{element:t,resize:function(a){n=116*a*devicePixelRatio,i=n/2,t.width=t.height=n,e()},setHeading:function(t){l=t,e()}}}function r(e,t){function n(e){return e*Math.PI/180}var i=e.coords,a=t.coords,l=n(i.latitude),o=n(i.longitude),d=n(a.latitude),r=n(a.longitude),u=6371e3,h=d-l,c=r-o,p=Math.sin(h/2),s=Math.sin(c/2),f=p*p+Math.cos(l)*Math.cos(d)*s*s,m=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),v=u*m;return v}function u(e){var t=document.createElement("div");return t.className=e,t}function h(){function e(){var e;e=null===f?"·":Math.round(f),i.nodeValue=e}var t="HeadingPanel",n=u(t+"-unit");n.appendChild(V("°"));var i=V("·"),a=u(t+"-value");a.appendChild(i),a.appendChild(n);var l=u("BottomPanel-label");l.appendChild(V("HEADING"));var o=l.classList,r=d(),h=u("BottomPanel");h.appendChild(l),h.appendChild(a),h.appendChild(r.element);var c,p=h.classList,s="highlight",f=null,m=null,v=[];return{element:h,resize:r.resize,highlight:function(){p.add(s),o.add(s),clearTimeout(c),c=setTimeout(function(){p.remove(s),o.remove(s)},200)},setHeading:function(t){if("number"==typeof t&&isFinite(t)){null!=m&&(t-m>180?t-=360:-180>t-m&&(t+=360)),m=t,v.push(t),v.length>3&&v.shift();var n=0;v.forEach(function(e){n+=e}),n/=v.length,f=(n%360+360)%360}else f=null,m=null,v.splice(0);r.setHeading(f),e()}}}function c(e){return g("HEADING","HeadingTab",e)}function p(){return{key:"imperial",distanceLabel:"MI",speedLabel:"MI/H",fix:function(e){return e/1.609344}}}function s(){function t(e){O.removeChild(O.firstChild),O.appendChild(e.element),e.highlight()}function n(e){g.setSpeed(e),c&&R.setSpeed(e)}function a(e){g.setUnit(e),E.setUnit(e),R.setUnit(e),U.setUnit(e),V.setUnit(e),F.unit=e.key,F.save()}function o(){var e=Date.now();r(function(){P.update(),w.update(),U.update(),setTimeout(o,Math.max(0,e+1e3-Date.now()))})}function d(e){c&&(s.add(e),E.update());var t=e.coords;n(t.speed);var i=t.accuracy;K.setStatus(8>i?"SIGNAL GOOD":16>i?"SIGNAL OK":"SIGNAL WEAK"),X(t.altitude),_(t.heading),K.hideError()}var r=window.requestAnimationFrame;r||(r=window.mozRequestAnimationFrame);var c=!1,s=D(),m=p(),C=v(),g=S(C),T=B(function(){t(P)},function(){t(E)},function(){t(w)},function(){t(R)},function(){t(U)},function(){t(G)},function(){t(V)},function(){t(y)}),P=N(),E=x(s,C),V=e(C),y=h(),w=l(),R=f(C),U=i(s,P,C),F=L(),G=b(F,function(){a(m)},function(){a(C)});a("imperial"==F.unit?m:C);var H="MainPanel",O=u(H+"-panel");O.appendChild(E.element);var k=M(function(){s.reset(),E.update(),P.reset(),R.reset(),U.reset()}),z=I(function(){c=!0,P.start(),s.start()},function(){c=!1,P.stop()}),K=A(),W=u(H+"-content");W.appendChild(g.element),W.appendChild(O),W.appendChild(K.element),W.appendChild(T.element),W.appendChild(k),W.appendChild(z.element);var q=u(H);q.appendChild(W);var X=V.setAltitude,_=y.setHeading;return navigator.geolocation.watchPosition(d,function(e){var t=e.code;K.setStatus(t==e.PERMISSION_DENIED?"PERMISSION DENIED":t==e.POSITION_UNAVAILABLE?"POSITION UNAVAILABLE":"TIMEOUT, RETRYING"),n(null),X(null),_(null),K.showError()},{enableHighAccuracy:!0,maximumAge:3e4,timeout:3e4}),o(),{element:q,resize:function(e,t){var n=320,i=480;if(e>t){var a=n;n=i,i=a}W.style.width=n+"px",W.style.height=i+"px",W.style.top=-i/2+"px",W.style.left=-n/2+"px";var l=e/n;l*i>t&&(l=t/i),q.style.transform="scale("+l+")",y.resize(l)}}}function f(e){function t(e){v=e,n()}function n(){var t=e.fix(18*v/5);t=Math.min(999.99,t),a.nodeValue=Math.floor(t),o.nodeValue=Math.floor(t%1*10)}var i="SpeedPanel",a=V("0"),l=u(i+"-integerPart");l.appendChild(a);var o=V("0"),d=u(i+"-fractionalPart");d.appendChild(V(".")),d.appendChild(o);var r=V(e.speedLabel),h=u(i+"-unit");h.appendChild(r);var c=u("BottomPanel-label");c.appendChild(V("MAX SPEED"));var p=c.classList,s=u("BottomPanel");s.appendChild(c),s.appendChild(l),s.appendChild(d),s.appendChild(h);var f,m=s.classList,v=0,C="highlight";return{element:s,highlight:function(){m.add(C),p.add(C),clearTimeout(f),f=setTimeout(function(){m.remove(C),p.remove(C)},200)},reset:function(){t(0)},setSpeed:function(e){isFinite(e)||(e=0),e>v&&t(e)},setUnit:function(t){e=t,r.nodeValue=e.speedLabel,n()}}}function m(e){return U("MAX","SPEED","MaxSpeedTab",e)}function v(){return{key:"metric",distanceLabel:"KM",speedLabel:"KM/H",fix:function(e){return e}}}function C(e,t){function n(){a.add("active"),clearTimeout(i),i=setTimeout(function(){t(),i=setTimeout(function(){a.remove("active")},150)},100)}var i,a=e.classList,l=!1;e.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),l?l=!1:n())}),e.addEventListener("touchstart",function(e){e.preventDefault(),l=!0,n()})}function g(e,t,n){var i=u("Tab-highlight");i.appendChild(V(e));var a=i.classList,l=u(t+" OneLineTab Tab Button");l.appendChild(i),C(l,n);var o,d=l.classList,r=!1,h="selected",c="highlight";return{element:l,deselect:function(){r=!1,d.remove(h),a.remove(h)},highlight:function(){a.add(c),clearTimeout(o),o=setTimeout(function(){a.remove(c)},200)},select:function(){r=!0,d.add(h),a.add(h)}}}function T(e){return g("PAGE 1","Page1Tab",e)}function P(e){return g("PAGE 2","Page2Tab",e)}function M(e){var t=u("ResetButton Button");return t.appendChild(V("RESET")),C(t,e),t}function L(){var e;try{e=localStorage.unit}catch(t){}var n={unit:e,save:function(){try{localStorage.unit=n.unit}catch(e){}}};return n}function b(e,t,n){var i="SettingsPanel",a="selected",l=u(i+"-imperialButton "+i+"-button Button");l.appendChild(V("IMPERIAL")),C(l,function(){o.classList.remove(a),l.classList.add(a),t()});var o=u(i+"-metricButton "+i+"-button Button");o.appendChild(V("METRIC")),C(o,function(){l.classList.remove(a),o.classList.add(a),n()}),"imperial"==e.unit?l.classList.add(a):o.classList.add(a);var d=u(i+"-fieldLabel");d.appendChild(V("UNITS:"));var r=u("BottomPanel-label");r.appendChild(V("SETTINGS"));var h=r.classList,c=u("BottomPanel");c.appendChild(r),c.appendChild(d),c.appendChild(l),c.appendChild(o);var p,s=c.classList,f="highlight";return{element:c,highlight:function(){s.add(f),h.add(f),clearTimeout(p),p=setTimeout(function(){s.remove(f),h.remove(f)},200)}}}function E(e){return g("SETTINGS","SettingsTab",e)}function S(e){function t(){var t,n,a;if(null===v)a="",t="·",n="·";else{var o=e.fix(18*v/5);o=Math.min(999.99,o),t=Math.floor(o),n=Math.floor(o%1*10),a=T?g?"":"↑":g?"↓":""}i.nodeValue=t,l.nodeValue=n,c.nodeValue=a}var n="SpeedLabel",i=V("·"),a=u(n+"-integerPart");a.appendChild(i);var l=V("·"),o=u(n+"-fractionalPart");o.appendChild(V(".")),o.appendChild(l);var d=V(e.speedLabel),r=u(n+"-unit");r.appendChild(d);var h=u(n+"-label");h.appendChild(V("SPEED"));var c=V("↕"),p=u(n+"-arrow");p.appendChild(c);var s=u(n);s.appendChild(h),s.appendChild(p),s.appendChild(a),s.appendChild(o),s.appendChild(r);var f,m,v=null,C=null,g=!1,T=!1,P=.02,M=[];return{element:s,setSpeed:function(e){if("number"==typeof e&&isFinite(e)){M.push(e),M.length>3&&M.shift();var n=0;M.forEach(function(e){n+=e}),n/=M.length,null!==C&&(n>C+P?(T=!0,clearTimeout(m),m=setTimeout(function(){T=!1,t()},2500)):C-P>n&&(g=!0,clearTimeout(f),f=setTimeout(function(){g=!1,t()},2500))),C=v,v=n}else v=null,C=null,M.splice(0),g=T=!1,clearTimeout(f),clearTimeout(m);t()},setUnit:function(n){e=n,d.nodeValue=e.speedLabel,t()}}}function I(e,t){var n=!1,i=V("START"),a=u("StartStopButton Button");return a.appendChild(i),C(a,function(){n?(n=!1,i.nodeValue="START",t()):(n=!0,i.nodeValue="STOP",e())}),{element:a}}function A(){function e(){d.add(c),clearTimeout(o),o=setTimeout(function(){d.remove(c)},200)}var t="StatusPanel",n=V("ACQUIRING"),i=u(t+"-value");i.appendChild(n);var a=i.classList,l=u(t);l.appendChild(V("GPS")),l.appendChild(i);var o,d=l.classList,r=!1,h="error",c="highlight";return{element:l,hideError:function(){r&&(r=!1,a.remove(h),e())},setStatus:function(e){n.nodeValue=e},showError:function(){r||(r=!0,a.add(h),e())}}}function B(e,n,i,l,d,r,h,p){function s(e){V.forEach(function(t){e!=t&&t.deselect()}),e.select()}var f=1,v=y(function(){s(v),n()}),C=w(function(){s(C),e()}),g=m(function(){s(g),l()}),M=a(function(){s(M),d()}),L=t(function(){s(L),h()}),b=c(function(){s(b),p()}),S=o(function(){s(S),i()}),I=E(function(){s(I),r()}),A=T(function(){1!=f&&(f=1,B.deselect(),x.removeChild(L.element),x.removeChild(b.element),x.removeChild(I.element),x.removeChild(S.element),x.appendChild(v.element),x.appendChild(C.element),x.appendChild(g.element),x.appendChild(M.element)),v.highlight(),C.highlight(),g.highlight(),M.highlight()}),B=P(function(){2!=f&&(f=2,A.deselect(),x.removeChild(v.element),x.removeChild(C.element),x.removeChild(g.element),x.removeChild(M.element),x.appendChild(L.element),x.appendChild(b.element),x.appendChild(I.element),x.appendChild(S.element)),L.highlight(),b.highlight(),I.highlight(),S.highlight()}),V=[v,C,g,M,L,b,S,I],D="Tabs",x=u(D);return x.appendChild(v.element),x.appendChild(C.element),x.appendChild(g.element),x.appendChild(M.element),x.appendChild(A.element),x.appendChild(B.element),{element:x}}function V(e){return document.createTextNode(e)}function D(){var e=0,t=[];return{add:function(i){var a;if(t.length&&(a=n(t)),t.push(i),t.length>3&&t.shift(),a){var l=n(t);e+=r(a,l)}},get:function(){return e},reset:function(){t.splice(0),e=0},start:function(){t.splice(0)}}}function x(e,t){function n(){var n=t.fix(e.get());n=Math.min(999999,Math.floor(n));var i=String(n%1e3);1==i.length?i="00"+i:2==i.length&&(i="0"+i),o.nodeValue=i,a.nodeValue=Math.floor(n/1e3)}var i="TripDistancePanel",a=V("0"),l=u(i+"-integerPart");l.appendChild(a);var o=V("000"),d=u(i+"-fractionalPart");d.appendChild(V(".")),d.appendChild(o);var r=V(t.distanceLabel),h=u(i+"-unit");h.appendChild(r);var c=u("BottomPanel-label");c.appendChild(V("TRIP DISTANCE"));var p=c.classList,s=u("BottomPanel");s.appendChild(c),s.appendChild(l),s.appendChild(d),s.appendChild(h);var f,m=s.classList,v="highlight";return{element:s,update:n,highlight:function(){m.add(v),p.add(v),clearTimeout(f),f=setTimeout(function(){m.remove(v),p.remove(v)},200)},setUnit:function(e){t=e,r.nodeValue=t.distanceLabel,n()}}}function y(e){var t=U("TRIP","DISTANCE","TripDistanceTab",e);return t.select(),t}function N(){var e="ClockPanel",t=V("00"),n=V("00"),i=V("00"),a=u(e+"-second");a.appendChild(V(":")),a.appendChild(i);var l=u("BottomPanel-label");l.appendChild(V("TRIP TIME"));var o=l.classList,d=u(e+"-content");d.appendChild(t),d.appendChild(V(":")),d.appendChild(n),d.appendChild(a);var r=u(e+" BottomPanel");r.appendChild(l),r.appendChild(d);var h,c=r.classList,p=0,s=null,f=359999e3,m="highlight";return{element:r,getTripTime:function(){return p},highlight:function(){c.add(m),o.add(m),clearTimeout(h),h=setTimeout(function(){c.remove(m),o.remove(m)},200)},reset:function(){p=0,null!==s&&(s=Date.now())},start:function(){s=Date.now()},stop:function(){p+=Date.now()-s,p=Math.min(p,f),s=null},update:function(){if(null!==s){var e=Date.now();p+=e-s,s=e}p=Math.min(p,f);var a=p/1e3;i.nodeValue=R(Math.floor(a%60));var l=a/60;n.nodeValue=R(Math.floor(l%60));var o=l/60;t.nodeValue=R(Math.floor(o))}}}function w(e){return U("TRIP","TIME","TripTimeTab",e)}function R(e){return e=String(e),1==e.length&&(e="0"+e),e}function U(e,t,n,i){var a="TwoLineTab "+n,l=u(a+"-content Tab-content");l.appendChild(V(e)),l.appendChild(document.createElement("br")),l.appendChild(V(t));var o=u("Tab-highlight");o.appendChild(u(a+"-aligner Tab-aligner")),o.appendChild(l);var d=o.classList,r=u(a+" Tab Button");r.appendChild(o),C(r,i);var h,c=r.classList,p=!1,s="selected",f="highlight";return{element:r,deselect:function(){p=!1,c.remove(s),d.remove(s)},highlight:function(){d.add(f),clearTimeout(h),h=setTimeout(function(){d.remove(f)},200)},select:function(){p=!0,c.add(s),d.add(s)}}}!function(){function e(){t.resize(innerWidth,innerHeight)}!function(){var e=document.createElement("style");e.innerHTML='@font-face {font-family: FreeMono;src: url(fonts/FreeMono.ttf);src: local("FreeMono"), url(fonts/FreeMono.ttf);font-weight: normal;}@font-face {font-family: FreeMono;src: url(fonts/FreeMonoBold.ttf);src: local("FreeMono Bold"), url(fonts/FreeMonoBold.ttf);font-weight: bold;}',document.head.appendChild(e)}();var t=s();document.body.appendChild(t.element),addEventListener("resize",e),e()}()}();