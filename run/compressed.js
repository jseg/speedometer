!function(){function e(e){var t={latitude:0,longitude:0};return e.forEach(function(e){t.latitude+=e.coords.latitude,t.longitude+=e.coords.longitude}),t.latitude/=e.length,t.longitude/=e.length,{coords:t}}function t(e,t,n){function a(){var a,i=t.getTripTime();a=0==i?0:e.get()/(i/1e3),a=n.fix(18*a/5),a=Math.min(999.99,a),d.nodeValue=Math.floor(a),r.nodeValue=Math.floor(a%1*10)}var i="SpeedPanel",d=b("0"),o=l(i+"-integerPart");o.appendChild(d);var r=b("0"),c=l(i+"-fractionalPart");c.appendChild(b(".")),c.appendChild(r);var u=b(n.speedLabel),p=l(i+"-unit");p.appendChild(u);var s=l("BottomPanel-label");s.appendChild(b("AVERAGE SPEED"));var h=s.classList,f=l("BottomPanel");f.appendChild(s),f.appendChild(o),f.appendChild(c),f.appendChild(p);var m,v=f.classList,C="highlight";return{element:f,reset:a,update:a,highlight:function(){clearTimeout(m),v.add(C),h.add(C),m=setTimeout(function(){v.remove(C),h.remove(C)},200)},setUnit:function(e){n=e,u.nodeValue=n.speedLabel,a()}}}function n(e){var t="AverageSpeedTab",n=l(t+"-content Tab-content");n.appendChild(b("AVERAGE")),n.appendChild(document.createElement("br")),n.appendChild(b("SPEED"));var a=l(t+" Tab Button");a.appendChild(l(t+"-aligner Tab-aligner")),a.appendChild(n),s(a,function(){e(),i.add(d)});var i=a.classList,d="selected";return{element:a,deselect:function(){i.remove(d)}}}function a(){var e="ClockPanel",t=b("00"),n=b("00"),a=b("00"),i=l(e+"-second");i.appendChild(b(":")),i.appendChild(a);var d=l(e+"-content BottomPanel-content");d.appendChild(t),d.appendChild(b(":")),d.appendChild(n),d.appendChild(i);var o=l("BottomPanel-label");o.appendChild(b("CLOCK"));var r=o.classList,c=l(e+" BottomPanel");c.appendChild(o),c.appendChild(d);var u,p=c.classList,s="highlight";return{element:c,highlight:function(){clearTimeout(u),p.add(s),r.add(s),u=setTimeout(function(){p.remove(s),r.remove(s)},200)},update:function(){var e=new Date;t.nodeValue=B(e.getHours()),n.nodeValue=B(e.getMinutes()),a.nodeValue=B(e.getSeconds())}}}function i(e){var t=l("Tab ClockTab Button");t.appendChild(b("CLOCK")),s(t,function(){e(),n.add(a)});var n=t.classList,a="selected";return{element:t,deselect:function(){n.remove(a)}}}function d(e,t){function n(e){return e*Math.PI/180}var a=e.coords,i=t.coords,d=n(a.latitude),l=n(a.longitude),o=n(i.latitude),r=n(i.longitude),c=6371e3,u=o-d,p=r-l,s=Math.sin(u/2),h=Math.sin(p/2),f=s*s+Math.cos(d)*Math.cos(o)*h*h,m=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),v=c*m;return v}function l(e){var t=document.createElement("div");return t.className=e,t}function o(){return{key:"imperial",distanceLabel:"M",speedLabel:"M/H",fix:function(e){return e}}}function r(){function e(e){O.removeChild(O.firstChild),O.appendChild(e.element),e.highlight()}function n(e){B.setSpeed(e),v&&N.setSpeed(e)}function i(e){B.setUnit(e),D.setUnit(e),N.setUnit(e),R.setUnit(e),y.unit=e.key,y.save()}function d(){var e=Date.now();u(function(){V.update(),w.update(),R.update(),setTimeout(d,Math.max(0,e+1e3-Date.now()))})}function r(e){v&&(b.add(e),D.update());var t=e.coords;n(t.speed);var a=t.accuracy;k.setStatus(8>a?"SIGNAL GOOD":16>a?"SIGNAL OK":"SIGNAL WEAK")}var u=window.requestAnimationFrame,s=window.cancelAnimationFrame;u||(u=window.mozRequestAnimationFrame,s=window.mozCancelAnimationFrame);var v=!1,b=M(),P=o(),I=p(),B=C(I),A=L(function(){e(V)},function(){e(D)},function(){e(w)},function(){e(N)},function(){e(R)},function(){e(x)}),V=E(),D=S(b,I),w=a(),N=c(I),R=t(b,V,I),y=f(),x=m(y,function(){i(P)},function(){i(I)});i("imperial"==y.unit?P:I);var F="MainPanel",O=l(F+"-panel");O.appendChild(D.element);var U=h(function(){b.reset(),D.update(),V.reset(),N.reset(),R.reset()}),G=g(function(){v=!0,V.start(),b.start()},function(){v=!1,V.stop()}),k=T(),H=l(F+"-content");H.appendChild(B.element),H.appendChild(O),H.appendChild(k.element),H.appendChild(A.element),H.appendChild(U),H.appendChild(G.element);var K=l(F);return K.appendChild(H),navigator.geolocation.watchPosition(r,function(e){var t=e.code;k.setStatus(t==e.PERMISSION_DENIED?"PERMISSION DENIED":t==e.POSITION_UNAVAILABLE?"POSITION UNAVAILABLE":"TIMEOUT, RETRYING"),n(0)},{enableHighAccuracy:!0,maximumAge:3e4,timeout:3e4}),d(),{element:K,resize:function(e,t){var n=320,a=480;if(e>t){var i=n;n=a,a=i}H.style.width=n+"px",H.style.height=a+"px",H.style.top=-a/2+"px",H.style.left=-n/2+"px";var d=e/n;d*a>t&&(d=t/a),K.style.transform="scale("+d+")"}}}function c(e){function t(e){v=e,n()}function n(){var t=e.fix(18*v/5);t=Math.min(999.99,t),i.nodeValue=Math.floor(t),o.nodeValue=Math.floor(t%1*10)}var a="SpeedPanel",i=b("0"),d=l(a+"-integerPart");d.appendChild(i);var o=b("0"),r=l(a+"-fractionalPart");r.appendChild(b(".")),r.appendChild(o);var c=b(e.speedLabel),u=l(a+"-unit");u.appendChild(c);var p=l("BottomPanel-label");p.appendChild(b("MAX SPEED"));var s=p.classList,h=l("BottomPanel");h.appendChild(p),h.appendChild(d),h.appendChild(r),h.appendChild(u);var f,m=h.classList,v=0,C="highlight";return{element:h,highlight:function(){clearTimeout(f),m.add(C),s.add(C),f=setTimeout(function(){m.remove(C),s.remove(C)},200)},reset:function(){t(0)},setSpeed:function(e){isFinite(e)||(e=0),e>v&&t(e)},setUnit:function(t){e=t,c.nodeValue=e.speedLabel,n()}}}function u(e){var t="MaxSpeedTab",n=l(t+"-content Tab-content");n.appendChild(b("MAX")),n.appendChild(document.createElement("br")),n.appendChild(b("SPEED"));var a=l(t+" Tab Button");a.appendChild(l(t+"-aligner Tab-aligner")),a.appendChild(n),s(a,function(){e(),i.add(d)});var i=a.classList,d="selected";return{element:a,deselect:function(){i.remove(d)}}}function p(){return{key:"metric",distanceLabel:"KM",speedLabel:"KM/H",fix:function(e){return 1.609344*e}}}function s(e,t){function n(){i.add("active"),clearTimeout(a),a=setTimeout(function(){t(),a=setTimeout(function(){i.remove("active")},150)},100)}var a,i=e.classList,d=!1;e.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),d?d=!1:n())}),e.addEventListener("touchstart",function(e){e.preventDefault(),d=!0,n()})}function h(e){var t=l("ResetButton Button");return t.appendChild(b("RESET")),s(t,e),t}function f(){var e;try{e=localStorage.unit}catch(t){}var n={unit:e,save:function(){try{localStorage.unit=n.unit}catch(e){}}};return n}function m(e,t,n){var a="SettingsPanel",i="selected",d=l(a+"-imperialButton "+a+"-button Button");d.appendChild(b("IMPERIAL")),s(d,function(){o.classList.remove(i),d.classList.add(i),t()});var o=l(a+"-metricButton "+a+"-button Button");o.appendChild(b("METRIC")),s(o,function(){d.classList.remove(i),o.classList.add(i),n()}),"imperial"==e.unit?d.classList.add(i):o.classList.add(i);var r=l(a+"-fieldLabel");r.appendChild(b("UNITS:"));var c=l("BottomPanel-label");c.appendChild(b("SETTINGS"));var u=c.classList,p=l("BottomPanel");p.appendChild(c),p.appendChild(r),p.appendChild(d),p.appendChild(o);var h,f=p.classList,m="highlight";return{element:p,highlight:function(){clearTimeout(h),f.add(m),u.add(m),h=setTimeout(function(){f.remove(m),u.remove(m)},200)}}}function v(e){var t=l("Tab SettingsTab Button");t.appendChild(b("SETTINGS")),s(t,function(){e(),n.add(a)});var n=t.classList,a="selected";return{element:t,deselect:function(){n.remove(a)}}}function C(e){function t(){var t=e.fix(18*v/5);t=Math.min(999.99,t),a.nodeValue=Math.floor(t),d.nodeValue=Math.floor(t%1*10);var n="";n=T?g?"":"↑":g?"↓":"",p.nodeValue=n}var n="SpeedLabel",a=b("0"),i=l(n+"-integerPart");i.appendChild(a);var d=b("0"),o=l(n+"-fractionalPart");o.appendChild(b(".")),o.appendChild(d);var r=b(e.speedLabel),c=l(n+"-unit");c.appendChild(r);var u=l(n+"-label");u.appendChild(b("SPEED"));var p=b("↕"),s=l(n+"-arrow");s.appendChild(p);var h=l(n);h.appendChild(u),h.appendChild(s),h.appendChild(i),h.appendChild(o),h.appendChild(c);var f,m,v=0,C=0,g=!1,T=!1,L=.02,M=[];return{element:h,setSpeed:function(e){isFinite(e)||(e=0),M.push(e),M.length>3&&M.shift();var n=0;M.forEach(function(e){n+=e}),n/=M.length,n>C+L?(T=!0,clearTimeout(m),m=setTimeout(function(){T=!1,t()},2500)):C-L>n&&(g=!0,clearTimeout(f),f=setTimeout(function(){g=!1,t()},2500)),C=v,v=n,t()},setUnit:function(n){e=n,r.nodeValue=e.speedLabel,t()}}}function g(e,t){var n=!1,a=b("START"),i=l("StartStopButton Button");return i.appendChild(a),s(i,function(){n?(n=!1,a.nodeValue="START",t()):(n=!0,a.nodeValue="STOP",e())}),{element:i}}function T(){var e=b("ACQUIRING"),t=l("StatusPanel");t.appendChild(b("GPS: ")),t.appendChild(e);var n,a=t.classList,i="highlight";return{element:t,setStatus:function(t){t!=e.nodeValue&&(e.nodeValue=t,clearTimeout(n),a.add(i),n=setTimeout(function(){a.remove(i)},200))}}}function L(e,t,a,d,o,r){var c=P(function(){p.deselect(),s.deselect(),h.deselect(),f.deselect(),m.deselect(),t()}),p=I(function(){c.deselect(),s.deselect(),h.deselect(),f.deselect(),m.deselect(),e()}),s=i(function(){c.deselect(),p.deselect(),h.deselect(),f.deselect(),m.deselect(),a()}),h=u(function(){c.deselect(),p.deselect(),s.deselect(),f.deselect(),m.deselect(),d()}),f=n(function(){c.deselect(),p.deselect(),s.deselect(),h.deselect(),m.deselect(),o()}),m=v(function(){c.deselect(),p.deselect(),s.deselect(),h.deselect(),f.deselect(),r()}),C="Tabs",g=l(C);return g.appendChild(c.element),g.appendChild(p.element),g.appendChild(s.element),g.appendChild(h.element),g.appendChild(f.element),g.appendChild(m.element),{element:g}}function b(e){return document.createTextNode(e)}function M(){var t=0,n=[];return{add:function(a){var i;if(n.length&&(i=e(n)),n.push(a),n.length>3&&n.shift(),i){var l=e(n);t+=d(i,l)}},get:function(){return t},reset:function(){n.splice(0),t=0},start:function(){n.splice(0)}}}function S(e,t){function n(){var n=t.fix(e.get());n=Math.min(999999,Math.floor(n));var a=String(n%1e3);1==a.length?a="00"+a:2==a.length&&(a="0"+a),o.nodeValue=a,i.nodeValue=Math.floor(n/1e3)}var a="TripDistancePanel",i=b("0"),d=l(a+"-integerPart");d.appendChild(i);var o=b("000"),r=l(a+"-fractionalPart");r.appendChild(b(".")),r.appendChild(o);var c=b(t.distanceLabel),u=l(a+"-unit");u.appendChild(c);var p=l("BottomPanel-label");p.appendChild(b("TRIP DISTANCE"));var s=p.classList,h=l("BottomPanel");h.appendChild(p),h.appendChild(d),h.appendChild(r),h.appendChild(u);var f,m=h.classList,v="highlight";return{element:h,update:n,highlight:function(){clearTimeout(f),m.add(v),s.add(v),f=setTimeout(function(){m.remove(v),s.remove(v)},200)},setUnit:function(e){t=e,c.nodeValue=t.distanceLabel,n()}}}function P(e){var t="TripDistanceTab",n=l(t+"-content Tab-content");n.appendChild(b("TRIP")),n.appendChild(document.createElement("br")),n.appendChild(b("DISTANCE"));var a=l(t+" Tab Button");a.appendChild(l(t+"-aligner Tab-aligner")),a.appendChild(n),s(a,function(){e(),d.add(i)});var i="selected",d=a.classList;return d.add(i),{element:a,deselect:function(){d.remove(i)}}}function E(){var e="ClockPanel",t=b("00"),n=b("00"),a=b("00"),i=l(e+"-second");i.appendChild(b(":")),i.appendChild(a);var d=l("BottomPanel-label");d.appendChild(b("TRIP TIME"));var o=d.classList,r=l(e+"-content");r.appendChild(t),r.appendChild(b(":")),r.appendChild(n),r.appendChild(i);var c=l(e+" BottomPanel");c.appendChild(d),c.appendChild(r);var u,p=c.classList,s=0,h=null,f=359999e3,m="highlight";return{element:c,getTripTime:function(){return s},highlight:function(){clearTimeout(u),p.add(m),o.add(m),u=setTimeout(function(){p.remove(m),o.remove(m)},200)},reset:function(){s=0,null!==h&&(h=Date.now())},start:function(){h=Date.now()},stop:function(){s+=Date.now()-h,s=Math.min(s,f),h=null},update:function(){if(null!==h){var e=Date.now();s+=e-h,h=e}s=Math.min(s,f);var i=s/1e3;a.nodeValue=B(Math.floor(i%60));var d=i/60;n.nodeValue=B(Math.floor(d%60));var l=d/60;t.nodeValue=B(Math.floor(l))}}}function I(e){var t="TripTimeTab",n=l(t+"-content Tab-content");n.appendChild(b("TRIP")),n.appendChild(document.createElement("br")),n.appendChild(b("TIME"));var a=l(t+" Tab Button");a.appendChild(l(t+"-aligner Tab-aligner")),a.appendChild(n),s(a,function(){e(),i.add(d)});var i=a.classList,d="selected";return{element:a,deselect:function(){i.remove(d)}}}function B(e){return e=String(e),1==e.length&&(e="0"+e),e}!function(){function e(){t.resize(innerWidth,innerHeight)}!function(){var e=document.createElement("style");e.innerHTML='@font-face {font-family: FreeMono;src: url(fonts/FreeMono.ttf);src: local("FreeMono"), url(fonts/FreeMono.ttf);font-weight: normal;}@font-face {font-family: FreeMono;src: url(fonts/FreeMonoBold.ttf);src: local("FreeMono Bold"), url(fonts/FreeMonoBold.ttf);font-weight: bold;}',document.head.appendChild(e)}();var t=r();document.body.appendChild(t.element),addEventListener("resize",e),e()}()}();