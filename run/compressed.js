!function(){function e(e){function n(){var n,t;if(null===m)t="···",n="·";else{var a=e.fix(m);a=Math.min(999999,Math.floor(a));var t=String(a%1e3);1==t.length?t="00"+t:2==t.length&&(t="0"+t),n=Math.floor(a/1e3)}i.nodeValue=n,l.nodeValue=t}var t="AltitudePanel",i=B("0"),a=r(t+"-integerPart");a.appendChild(i);var l=B("000"),o=r(t+"-fractionalPart");o.appendChild(B(".")),o.appendChild(l);var d=B(e.distanceLabel),u=r(t+"-unit");u.appendChild(d);var p=r("BottomPanel-label");p.appendChild(B("ALTITUDE"));var h=p.classList,c=r("BottomPanel");c.appendChild(p),c.appendChild(a),c.appendChild(o),c.appendChild(u);var s,f=c.classList,m=null,v=[],C="highlight";return{element:c,highlight:function(){f.add(C),h.add(C),clearTimeout(s),s=setTimeout(function(){f.remove(C),h.remove(C)},200)},setAltitude:function(e){if("number"==typeof e&&isFinite(e)){v.push(e),v.length>3&&v.shift();var t=0;v.forEach(function(e){t+=e}),t/=v.length,m=t}else m=null,v.splice(0);n()},setUnit:function(t){e=t,d.nodeValue=e.distanceLabel,n()}}}function n(e){return C("ALTITUDE","AltitudeTab",e)}function t(e){var n={latitude:0,longitude:0};return e.forEach(function(e){n.latitude+=e.coords.latitude,n.longitude+=e.coords.longitude}),n.latitude/=e.length,n.longitude/=e.length,{coords:n}}function i(e,n,t){function i(){var i,a=n.getTripTime();i=0==a?0:e.get()/(a/1e3),i=t.fix(18*i/5),i=Math.min(999.99,i),l.nodeValue=Math.floor(i),d.nodeValue=Math.floor(i%1*10)}var a="SpeedPanel",l=B("0"),o=r(a+"-integerPart");o.appendChild(l);var d=B("0"),u=r(a+"-fractionalPart");u.appendChild(B(".")),u.appendChild(d);var p=B(t.speedLabel),h=r(a+"-unit");h.appendChild(p);var c=r("BottomPanel-label");c.appendChild(B("AVERAGE SPEED"));var s=c.classList,f=r("BottomPanel");f.appendChild(c),f.appendChild(o),f.appendChild(u),f.appendChild(h);var m,v=f.classList,C="highlight";return{element:f,reset:i,update:i,highlight:function(){v.add(C),s.add(C),clearTimeout(m),m=setTimeout(function(){v.remove(C),s.remove(C)},200)},setUnit:function(e){t=e,p.nodeValue=t.speedLabel,i()}}}function a(e){return U("AVERAGE","SPEED","AverageSpeedTab",e)}function l(){var e="ClockPanel",n=B("00"),t=B("00"),i=B("00"),a=r(e+"-second");a.appendChild(B(":")),a.appendChild(i);var l=r(e+"-content BottomPanel-content");l.appendChild(n),l.appendChild(B(":")),l.appendChild(t),l.appendChild(a);var o=r("BottomPanel-label");o.appendChild(B("CLOCK"));var d=o.classList,u=r(e+" BottomPanel");u.appendChild(o),u.appendChild(l);var p,h=u.classList,c="highlight";return{element:u,highlight:function(){h.add(c),d.add(c),clearTimeout(p),p=setTimeout(function(){h.remove(c),d.remove(c)},200)},update:function(){var e=new Date;n.nodeValue=R(e.getHours()),t.nodeValue=R(e.getMinutes()),i.nodeValue=R(e.getSeconds())}}}function o(e){return C("CLOCK","ClockTab",e)}function d(e,n){function t(e){return e*Math.PI/180}var i=e.coords,a=n.coords,l=t(i.latitude),o=t(i.longitude),d=t(a.latitude),r=t(a.longitude),u=6371e3,p=d-l,h=r-o,c=Math.sin(p/2),s=Math.sin(h/2),f=c*c+Math.cos(l)*Math.cos(d)*s*s,m=2*Math.atan2(Math.sqrt(f),Math.sqrt(1-f)),v=u*m;return v}function r(e){var n=document.createElement("div");return n.className=e,n}function u(){function e(){var e;e=null===s?"·":Math.round(s),i.nodeValue=e}var n="HeadingPanel",t=r(n+"-unit");t.appendChild(B("°"));var i=B("·"),a=r(n+"-value");a.appendChild(i),a.appendChild(t);var l=r("BottomPanel-label");l.appendChild(B("HEADING"));var o=l.classList,d=CompassPanel(),u=r("BottomPanel");u.appendChild(l),u.appendChild(a),u.appendChild(d.element);var p,h=u.classList,c="highlight",s=null,f=null,m=[];return{element:u,resize:d.resize,highlight:function(){h.add(c),o.add(c),clearTimeout(p),p=setTimeout(function(){h.remove(c),o.remove(c)},200)},setHeading:function(n){if("number"==typeof n&&isFinite(n)){null!=f&&(n-f>180?n-=360:-180>n-f&&(n+=360)),f=n,m.push(n),m.length>3&&m.shift();var t=0;m.forEach(function(e){t+=e}),t/=m.length,s=(t%360+360)%360}else s=null,f=null,m.splice(0);d.setHeading(s),e()}}}function p(e){return C("HEADING","HeadingTab",e)}function h(){return{key:"imperial",distanceLabel:"MI",speedLabel:"MI/H",fix:function(e){return e}}}function c(){function n(e){z.removeChild(z.firstChild),z.appendChild(e.element),e.highlight()}function t(e){T.setSpeed(e),f&&F.setSpeed(e)}function a(e){T.setUnit(e),w.setUnit(e),F.setUnit(e),x.setUnit(e),y.setUnit(e),G.unit=e.key,G.save()}function o(){var e=Date.now();p(function(){B.update(),U.update(),x.update(),setTimeout(o,Math.max(0,e+1e3-Date.now()))})}function d(e){f&&(v.add(e),w.update());var n=e.coords;t(n.speed);var i=n.accuracy;q.setStatus(8>i?"SIGNAL GOOD":16>i?"SIGNAL OK":"SIGNAL WEAK"),y.setAltitude(n.altitude),R.setHeading(n.heading)}var p=window.requestAnimationFrame,c=window.cancelAnimationFrame;p||(p=window.mozRequestAnimationFrame,c=window.mozCancelAnimationFrame);var f=!1,v=V(),C=h(),g=m(),T=E(g),b=A(function(){n(B)},function(){n(w)},function(){n(U)},function(){n(F)},function(){n(x)},function(){n(O)},function(){n(y)},function(){n(R)}),B=N(),w=D(v,g),y=e(g),R=u(),U=l(),F=s(g),x=i(v,B,g),G=P(),O=M(G,function(){a(C)},function(){a(g)});a("imperial"==G.unit?C:g);var H="MainPanel",z=r(H+"-panel");z.appendChild(w.element);var k=L(function(){v.reset(),w.update(),B.reset(),F.reset(),x.reset()}),K=S(function(){f=!0,B.start(),v.start()},function(){f=!1,B.stop()}),q=I(),W=r(H+"-content");W.appendChild(T.element),W.appendChild(z),W.appendChild(q.element),W.appendChild(b.element),W.appendChild(k),W.appendChild(K.element);var X=r(H);return X.appendChild(W),window.updatePosition=d,navigator.geolocation.watchPosition(d,function(e){var n=e.code;q.setStatus(n==e.PERMISSION_DENIED?"PERMISSION DENIED":n==e.POSITION_UNAVAILABLE?"POSITION UNAVAILABLE":"TIMEOUT, RETRYING"),t(null)},{enableHighAccuracy:!0,maximumAge:3e4,timeout:3e4}),o(),{element:X,resize:function(e,n){var t=320,i=480;if(e>n){var a=t;t=i,i=a}W.style.width=t+"px",W.style.height=i+"px",W.style.top=-i/2+"px",W.style.left=-t/2+"px";var l=e/t;l*i>n&&(l=n/i),X.style.transform="scale("+l+")",R.resize(l)}}}function s(e){function n(e){v=e,t()}function t(){var n=e.fix(18*v/5);n=Math.min(999.99,n),a.nodeValue=Math.floor(n),o.nodeValue=Math.floor(n%1*10)}var i="SpeedPanel",a=B("0"),l=r(i+"-integerPart");l.appendChild(a);var o=B("0"),d=r(i+"-fractionalPart");d.appendChild(B(".")),d.appendChild(o);var u=B(e.speedLabel),p=r(i+"-unit");p.appendChild(u);var h=r("BottomPanel-label");h.appendChild(B("MAX SPEED"));var c=h.classList,s=r("BottomPanel");s.appendChild(h),s.appendChild(l),s.appendChild(d),s.appendChild(p);var f,m=s.classList,v=0,C="highlight";return{element:s,highlight:function(){m.add(C),c.add(C),clearTimeout(f),f=setTimeout(function(){m.remove(C),c.remove(C)},200)},reset:function(){n(0)},setSpeed:function(e){isFinite(e)||(e=0),e>v&&n(e)},setUnit:function(n){e=n,u.nodeValue=e.speedLabel,t()}}}function f(e){return U("MAX","SPEED","MaxSpeedTab",e)}function m(){return{key:"metric",distanceLabel:"KM",speedLabel:"KM/H",fix:function(e){return 1.609344*e}}}function v(e,n){function t(){a.add("active"),clearTimeout(i),i=setTimeout(function(){n(),i=setTimeout(function(){a.remove("active")},150)},100)}var i,a=e.classList,l=!1;e.addEventListener("mousedown",function(e){0===e.button&&(e.preventDefault(),l?l=!1:t())}),e.addEventListener("touchstart",function(e){e.preventDefault(),l=!0,t()})}function C(e,n,t){var i=r("Tab-highlight");i.appendChild(B(e));var a=i.classList,l=r(n+" OneLineTab Tab Button");l.appendChild(i),v(l,t);var o,d=l.classList,u=!1,p="selected",h="highlight";return{element:l,deselect:function(){u=!1,d.remove(p),a.remove(p)},highlight:function(){a.add(h),clearTimeout(o),o=setTimeout(function(){a.remove(h)},200)},select:function(){u=!0,d.add(p),a.add(p)}}}function g(e){return C("PAGE 1","Page1Tab",e)}function T(e){return C("PAGE 2","Page2Tab",e)}function L(e){var n=r("ResetButton Button");return n.appendChild(B("RESET")),v(n,e),n}function P(){var e;try{e=localStorage.unit}catch(n){}var t={unit:e,save:function(){try{localStorage.unit=t.unit}catch(e){}}};return t}function M(e,n,t){var i="SettingsPanel",a="selected",l=r(i+"-imperialButton "+i+"-button Button");l.appendChild(B("IMPERIAL")),v(l,function(){o.classList.remove(a),l.classList.add(a),n()});var o=r(i+"-metricButton "+i+"-button Button");o.appendChild(B("METRIC")),v(o,function(){l.classList.remove(a),o.classList.add(a),t()}),"imperial"==e.unit?l.classList.add(a):o.classList.add(a);var d=r(i+"-fieldLabel");d.appendChild(B("UNITS:"));var u=r("BottomPanel-label");u.appendChild(B("SETTINGS"));var p=u.classList,h=r("BottomPanel");h.appendChild(u),h.appendChild(d),h.appendChild(l),h.appendChild(o);var c,s=h.classList,f="highlight";return{element:h,highlight:function(){s.add(f),p.add(f),clearTimeout(c),c=setTimeout(function(){s.remove(f),p.remove(f)},200)}}}function b(e){return C("SETTINGS","SettingsTab",e)}function E(e){function n(){var n,t,a;if(null===v)a="",n="·",t="·";else{var o=e.fix(18*v/5);o=Math.min(999.99,o),n=Math.floor(o),t=Math.floor(o%1*10),a=T?g?"":"↑":g?"↓":""}i.nodeValue=n,l.nodeValue=t,h.nodeValue=a}var t="SpeedLabel",i=B("·"),a=r(t+"-integerPart");a.appendChild(i);var l=B("·"),o=r(t+"-fractionalPart");o.appendChild(B(".")),o.appendChild(l);var d=B(e.speedLabel),u=r(t+"-unit");u.appendChild(d);var p=r(t+"-label");p.appendChild(B("SPEED"));var h=B("↕"),c=r(t+"-arrow");c.appendChild(h);var s=r(t);s.appendChild(p),s.appendChild(c),s.appendChild(a),s.appendChild(o),s.appendChild(u);var f,m,v=null,C=null,g=!1,T=!1,L=.02,P=[];return{element:s,setSpeed:function(e){if("number"==typeof e&&isFinite(e)){P.push(e),P.length>3&&P.shift();var t=0;P.forEach(function(e){t+=e}),t/=P.length,null!==C&&(t>C+L?(T=!0,clearTimeout(m),m=setTimeout(function(){T=!1,n()},2500)):C-L>t&&(g=!0,clearTimeout(f),f=setTimeout(function(){g=!1,n()},2500))),C=v,v=t}else v=null,C=null,P.splice(0),g=T=!1,clearTimeout(f),clearTimeout(m);n()},setUnit:function(t){e=t,d.nodeValue=e.speedLabel,n()}}}function S(e,n){var t=!1,i=B("START"),a=r("StartStopButton Button");return a.appendChild(i),v(a,function(){t?(t=!1,i.nodeValue="START",n()):(t=!0,i.nodeValue="STOP",e())}),{element:a}}function I(){var e="StatusPanel",n=B("ACQUIRING"),t=r(e+"-value");t.appendChild(n);var i=r(e);i.appendChild(B("GPS")),i.appendChild(t);var a,l=i.classList,o="highlight";return{element:i,setStatus:function(e){e!=n.nodeValue&&(n.nodeValue=e,l.add(o),clearTimeout(a),a=setTimeout(function(){l.remove(o)},200))}}}function A(e,t,i,l,d,u,h,c){function s(e){V.forEach(function(n){e!=n&&n.deselect()}),e.select()}var m=1,v=w(function(){s(v),t()}),C=y(function(){s(C),e()}),L=f(function(){s(L),l()}),P=a(function(){s(P),d()}),M=n(function(){s(M),h()}),E=p(function(){s(E),c()}),S=o(function(){s(S),i()}),I=b(function(){s(I),u()}),A=g(function(){1!=m&&(m=1,B.deselect(),N.removeChild(M.element),N.removeChild(E.element),N.removeChild(I.element),N.removeChild(S.element),N.appendChild(v.element),N.appendChild(C.element),N.appendChild(L.element),N.appendChild(P.element)),v.highlight(),C.highlight(),L.highlight(),P.highlight()}),B=T(function(){2!=m&&(m=2,A.deselect(),N.removeChild(v.element),N.removeChild(C.element),N.removeChild(L.element),N.removeChild(P.element),N.appendChild(M.element),N.appendChild(E.element),N.appendChild(I.element),N.appendChild(S.element)),M.highlight(),E.highlight(),I.highlight(),S.highlight()}),V=[v,C,L,P,M,E,S,I],D="Tabs",N=r(D);return N.appendChild(v.element),N.appendChild(C.element),N.appendChild(L.element),N.appendChild(P.element),N.appendChild(A.element),N.appendChild(B.element),{element:N}}function B(e){return document.createTextNode(e)}function V(){var e=0,n=[];return{add:function(i){var a;if(n.length&&(a=t(n)),n.push(i),n.length>3&&n.shift(),a){var l=t(n);e+=d(a,l)}},get:function(){return e},reset:function(){n.splice(0),e=0},start:function(){n.splice(0)}}}function D(e,n){function t(){var t=n.fix(e.get());t=Math.min(999999,Math.floor(t));var i=String(t%1e3);1==i.length?i="00"+i:2==i.length&&(i="0"+i),o.nodeValue=i,a.nodeValue=Math.floor(t/1e3)}var i="TripDistancePanel",a=B("0"),l=r(i+"-integerPart");l.appendChild(a);var o=B("000"),d=r(i+"-fractionalPart");d.appendChild(B(".")),d.appendChild(o);var u=B(n.distanceLabel),p=r(i+"-unit");p.appendChild(u);var h=r("BottomPanel-label");h.appendChild(B("TRIP DISTANCE"));var c=h.classList,s=r("BottomPanel");s.appendChild(h),s.appendChild(l),s.appendChild(d),s.appendChild(p);var f,m=s.classList,v="highlight";return{element:s,update:t,highlight:function(){m.add(v),c.add(v),clearTimeout(f),f=setTimeout(function(){m.remove(v),c.remove(v)},200)},setUnit:function(e){n=e,u.nodeValue=n.distanceLabel,t()}}}function w(e){var n=U("TRIP","DISTANCE","TripDistanceTab",e);return n.select(),n}function N(){var e="ClockPanel",n=B("00"),t=B("00"),i=B("00"),a=r(e+"-second");a.appendChild(B(":")),a.appendChild(i);var l=r("BottomPanel-label");l.appendChild(B("TRIP TIME"));var o=l.classList,d=r(e+"-content");d.appendChild(n),d.appendChild(B(":")),d.appendChild(t),d.appendChild(a);var u=r(e+" BottomPanel");u.appendChild(l),u.appendChild(d);var p,h=u.classList,c=0,s=null,f=359999e3,m="highlight";return{element:u,getTripTime:function(){return c},highlight:function(){h.add(m),o.add(m),clearTimeout(p),p=setTimeout(function(){h.remove(m),o.remove(m)},200)},reset:function(){c=0,null!==s&&(s=Date.now())},start:function(){s=Date.now()},stop:function(){c+=Date.now()-s,c=Math.min(c,f),s=null},update:function(){if(null!==s){var e=Date.now();c+=e-s,s=e}c=Math.min(c,f);var a=c/1e3;i.nodeValue=R(Math.floor(a%60));var l=a/60;t.nodeValue=R(Math.floor(l%60));var o=l/60;n.nodeValue=R(Math.floor(o))}}}function y(e){return U("TRIP","TIME","TripTimeTab",e)}function R(e){return e=String(e),1==e.length&&(e="0"+e),e}function U(e,n,t,i){var a="TwoLineTab "+t,l=r(a+"-content Tab-content");l.appendChild(B(e)),l.appendChild(document.createElement("br")),l.appendChild(B(n));var o=r("Tab-highlight");o.appendChild(r(a+"-aligner Tab-aligner")),o.appendChild(l);var d=o.classList,u=r(a+" Tab Button");u.appendChild(o),v(u,i);var p,h=u.classList,c=!1,s="selected",f="highlight";return{element:u,deselect:function(){c=!1,h.remove(s),d.remove(s)},highlight:function(){d.add(f),clearTimeout(p),p=setTimeout(function(){d.remove(f)},200)},select:function(){c=!0,h.add(s),d.add(s)}}}!function(){function e(){n.resize(innerWidth,innerHeight)}!function(){var e=document.createElement("style");e.innerHTML='@font-face {font-family: FreeMono;src: url(fonts/FreeMono.ttf);src: local("FreeMono"), url(fonts/FreeMono.ttf);font-weight: normal;}@font-face {font-family: FreeMono;src: url(fonts/FreeMonoBold.ttf);src: local("FreeMono Bold"), url(fonts/FreeMonoBold.ttf);font-weight: bold;}',document.head.appendChild(e)}();var n=c();document.body.appendChild(n.element),addEventListener("resize",e),e()}()}();